<template id="template-num">
    <slot style="display: none;"></slot>
</template>

<script type="module">
    customElements.define('ca-num', class extends HTMLElement {
        constructor() {
            super()
            const dom = document.getElementById('template-num').content.cloneNode(true)
            dom.querySelector('slot').addEventListener('slotchange', e => this.render())
            this.type = this.getAttribute('type') || 'html'
            this.content = (() => {
                switch (this.type) {
                    case 'tex': return document.createElement('ca-katex')
                    case 'html': return document.createElement('span')
                    case 'plain': return document.createElement('span')
                }
            })()
            dom.appendChild(this.content)

            this.attachShadow({mode: 'open'})
            this.shadowRoot.appendChild(dom)
        }

        render() {
            const format = this.getAttribute('format') || 'e'
            const exp = parseFloat(this.shadowRoot.querySelector('slot').assignedNodes()[0].textContent.trim())
            this.content.innerHTML = exp_num_to_str(exp, format, this.type)
        }

        static get observedAttributes() {
            return ['format']
        }

        attributeChangedCallback(name, oldValue, newValue) {
            this.render()
        }
    })
</script>

